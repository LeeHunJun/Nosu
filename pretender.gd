extends Node2D
	
const in_edit_mode: bool = false
var current_level_name = "pretender"

var fk_fall_time: float = 1.1
var fk_output_arr = [[], [], [], []]

var level_info = {
	"pretender" = {
		"fk_times": "[[3.64501123428345, 4.55163269042969, 5.37292509078979, 5.99156455993652, 6.55684833526611, 7.67680244445801, 8.2954423904419, 8.92473964691162, 10.353991317749, 10.9512928009033, 11.527255821228, 12.9991834640503, 13.6178234100342, 14.2257831573486, 15.0470741271973, 15.9217002868652, 16.4976642608643, 17.5002716064453, 18.353560256958, 18.9721992492676, 19.6761672973633, 20.8067577362061, 21.3934009552002, 21.9267127990723, 22.7373245239258, 23.5799549102783, 24.1985939025879, 24.8705432891846, 26.0544898986816, 26.6731288909912, 27.2490928649902, 28.9236743927002, 29.4996364593506, 33.0941055297852, 33.3927658081055, 35.685986328125, 37.7871864318848, 40.0164154052734, 40.3470504760742, 42.5549438476562, 42.8215873718262, 43.0242622375488, 44.6455085754395, 47.5466888427734, 49.1039245605469, 52.0051010131836, 53.5517013549805, 54.2236526489258, 58.4794319152832, 59.2687309265137, 59.9833572387695, 60.8473022460937, 66.0843551635742, 66.468342590332, 68.8042190551758, 69.1241958618164, 72.5800216674805, 77.2197769165039, 77.5290954589844, 79.7689559936523, 80.1529510498047, 81.6995208740234, 82.9154632568359, 84.0674179077148, 86.2646224975586, 90.0297515869141, 92.2802932739258, 93.6029022216797, 94.701496887207, 95.9174392700195, 97.2933776855469, 97.4640396118164, 97.922673034668, 98.1146514892578, 99.9278915405273, 105.314282226563, 107.522152709961, 108.866078186035, 110.423336791992, 110.967304992676, 112.385899353027, 115.671063232422, 116.993649291992, 119.425534057617, 120.812107849121, 122.017391967773, 124.513264465332, 124.875897216797, 126.518475341797, 126.827801513672, 128.097073364258, 129.867642211914, 132.342175292969, 133.963421630859, 134.891354370117, 135.819317626953, 136.42727355957, 137.472561645508, 138.325848388672, 138.912487792969, 140.747052001953, 144.042874145508, 145.866772460938, 146.528088378906, 147.818692016602, 148.373303222656, 152.095776367188, 153.525051879883, 156.746212768555, 160.650006103516, 161.353970336914, 161.737942504883, 162.687237548828, 163.017864990234, 166.43102722168, 168.532238769531, 171.081448364258, 171.828076171875, 173.673306274414, 174.355938720703, 175.635876464844, 176.670483398438, 177.619778442383, 178.611721801758, 182.878170776367, 186.248638916016, 187.517910766602, 188.680523681641, 191.432354736328, 193.874905395508, 194.664196777344, 195.229504394531, 197.576031494141, 197.885357666016, 199.527935791016, 199.869244384766, 204.050366210938, 206.076916503906, 210.311367797852, 211.623287963867, 216.871014404297, 218.129620361328, 219.377545166016, 222.726712036133, 223.398663330078, 224.027966308594, 224.614605712891, 225.275891113281, 225.905194091797, 226.662487792969, 228.26240234375, 230.107647705078, 231.771557617188, 233.734127807617, 235.632672119141, 236.880612182617, 239.365826416016, 239.685803222656, 242.84296875, 246.064129638672, 249.157299804688, 252.634442138672, 254.085034179688, 255.268994140625, 256.335583496094, 257.754162597656, 260.143383789063, 260.516674804688, 262.159283447266, 262.48994140625, 263.716534423828, 266.137738037109, 269.636212158203, 273.614666748047, 278.350415039063, 279.662335205078, 282.008892822266, 285.272717285156, 286.435314941406, 287.555249023438, 290.541760253906, 293.432263183594, 294.210919189453, 295.085522460938, 295.650830078125, 297.218762207031, 297.816052246094, 298.413342285156, 299.362622070313, 300.119946289063, 300.663891601563, 301.271862792969, 302.743786621094, 303.341076660156, 303.714398193359, 304.589031982422, 305.452984619141, 306.114270019531, 307.202221679688, 308.002178955078, 308.652813720703, 309.271435546875, 310.455364990234, 311.063336181641, 311.713970947266, 312.769909667969, 313.431225585938, 313.708538818359], [1.08514742851257, 3.77301578521729, 5.05294780731201, 5.67156438827515, 6.2688663482666, 7.1008394241333, 7.97544174194336, 8.57274417877197, 9.70335559844971, 10.6526306152344, 11.2179363250732, 11.825918006897, 12.5938776016235, 13.3404987335205, 13.9058044433594, 14.4924266815186, 15.6230381011963, 16.1883438110352, 16.8496368408203, 18.0335834503174, 18.6735370635986, 19.2921760559082, 20.2841270446777, 21.1267574310303, 21.6493881225586, 22.1933563232422, 23.3453052520752, 23.8999317169189, 24.5719039916992, 25.5211799621582, 26.3958042144775, 26.9717681884766, 27.5264175415039, 29.2436511993408, 29.979615020752, 30.3422668457031, 30.6409080505371, 30.9822204589844, 31.3768699645996, 31.6541946411133, 33.8300674438477, 34.203377532959, 36.8272560119629, 38.1711776733398, 40.6670539855957, 44.1335380554199, 45.6481178283691, 48.6986167907715, 51.4291389465332, 52.3997505187988, 53.9036720275879, 55.7915657043457, 55.9515655517578, 56.2395446777344, 56.3782089233398, 56.8688438415527, 57.1995018005371, 57.391495513916, 59.5460327148437, 60.4206588745117, 62.8312042236328, 66.0843551635742, 66.4470031738281, 68.8042190551758, 69.1241958618164, 71.4280746459961, 72.9319961547852, 74.5745819091797, 77.3157623291016, 77.6144226074219, 80.4729278564453, 82.2008407592773, 83.4807708740234, 84.643376159668, 86.6165969848633, 92.9629257202148, 94.1788681030273, 95.2774856567383, 96.2480972290039, 98.5199783325195, 100.471859741211, 103.597027587891, 105.975575256348, 108.268772888184, 109.442066955566, 111.447277832031, 112.023243713379, 113.43117980957, 113.761837768555, 116.321697998047, 117.292309570313, 119.745510864258, 121.420094299316, 122.31602935791, 125.227894592285, 127.094448852539, 130.422268676758, 132.598156738281, 134.294064331055, 135.467343139648, 136.117977905273, 136.768597412109, 137.995220947266, 138.624508666992, 139.328457641602, 139.765789794922, 141.47236328125, 145.322811889648, 146.144100952148, 147.520016479492, 148.096005249023, 150.111904907227, 151.466488647461, 152.565106201172, 153.866375732422, 154.549008178711, 156.991513061523, 160.959317016602, 162.687237548828, 163.017864990234, 163.956478881836, 166.207028198242, 166.804333496094, 169.71618347168, 171.412091064453, 172.105389404297, 174.003964233398, 174.654583740234, 175.977185058594, 177.182446289063, 178.110409545898, 180.328961181641, 183.816784667969, 186.856594848633, 188.115216064453, 189.448483276367, 190.035107421875, 190.355084228516, 192.008343505859, 194.504193115234, 195.101498413086, 198.216015625, 200.19990234375, 201.68249206543, 202.365124511719, 202.983746337891, 203.602383422852, 205.447613525391, 205.596936035156, 205.756939697266, 207.730160522461, 208.978100585938, 215.484417724609, 216.871014404297, 220.711544799805, 223.014691162109, 223.707974243164, 224.326626586914, 224.913235473633, 228.827709960938, 230.555630493164, 232.102200317383, 234.683407592773, 235.760678100586, 237.221920776367, 239.995129394531, 242.224331665039, 243.941571044922, 244.538861083984, 244.965512084961, 248.122677612305, 249.765255737305, 253.01842956543, 253.914379882813, 254.085034179688, 255.119641113281, 256.986218261719, 258.116833496094, 260.815350341797, 262.788586425781, 265.572430419922, 266.735028076172, 270.937481689453, 273.614666748047, 274.169293212891, 276.761151123047, 278.873059082031, 282.019543457031, 282.712872314453, 283.064831542969, 285.912670898438, 286.936627197266, 293.709606933594, 294.808209228516, 295.384167480469, 295.992138671875, 297.560070800781, 298.104046630859, 298.76533203125, 299.831921386719, 300.40791015625, 300.962536621094, 303.085095214844, 303.991711425781, 305.1330078125, 305.762280273438, 306.4982421875, 307.703503417969, 308.332806396484, 308.962109375, 310.764691162109, 311.404644775391, 312.311260986328, 313.111218261719, 313.761853027344], [0.96782307624817, 3.94367341995239, 4.72229032516479, 5.5435827255249, 6.1408842086792, 6.69551067352295, 7.82612209320068, 8.43408184051514, 8.72208576202393, 9.87401371002197, 10.8232877731323, 11.3992746353149, 12.3485486984253, 13.2018363952637, 13.7671430587769, 14.3964393615723, 15.4843757629395, 16.0710208892822, 16.700318145752, 17.6495922088623, 18.5242183685303, 19.1321990966797, 20.1241271972656, 20.9880950927734, 21.5214050292969, 22.0866897583008, 22.9186618804932, 23.7292736053467, 24.4225852966309, 25.3718593597412, 26.2358043670654, 26.8331058502197, 27.4197509765625, 28.2197044372559, 28.7530162811279, 29.0943305969238, 29.6702945709229, 32.0381629943848, 33.2221076965332, 33.5314300537109, 35.1740119934082, 36.635262298584, 37.1898849487305, 37.9791839599609, 38.587166595459, 40.0164154052734, 40.4003837585449, 41.0510185241699, 43.6322219848633, 43.8348739624023, 44.9654891967773, 46.2347381591797, 47.237370300293, 48.1866424560547, 49.4772346496582, 50.1705444335937, 51.6531303405762, 52.5170753479004, 53.7010200500488, 54.564965057373, 54.7249649047852, 58.042130279541, 58.2341049194336, 58.6820877075195, 59.7273681640625, 60.5379837036133, 62.9805191040039, 66.8416564941406, 67.5242889404297, 67.8762557983398, 69.4335144042969, 70.094807434082, 70.4787948608398, 71.7480514526367, 72.4520156860352, 72.75068359375, 74.0199325561523, 74.9265563964844, 75.5025146484375, 76.6331298828125, 76.9317901611328, 77.9237411499023, 79.1716583251953, 79.5023162841797, 79.8649642944336, 80.2169387817383, 80.8782318115234, 82.072834777832, 83.3314483642578, 84.2700698852539, 85.5819976806641, 87.7685516357422, 88.8138092041016, 90.1257598876953, 91.6190002441406, 91.9176681518555, 92.6216094970703, 93.9228790283203, 94.8508422851562, 96.0667541503906, 98.6479614257812, 99.1172760009766, 100.130543518066, 101.293148803711, 101.719792175293, 101.901135253906, 102.647755432129, 103.927685546875, 105.666256713867, 106.914196777344, 107.767483520508, 109.047413635254, 110.530003356934, 111.084622192383, 112.769886779785, 114.74310760498, 115.393742370605, 116.193699645996, 117.164311218262, 118.433583068848, 119.030880737305, 119.564198303223, 120.97211151123, 122.166714477539, 122.678684997559, 125.526531982422, 127.521084594727, 128.427716064453, 129.121014404297, 129.696987915039, 130.294293212891, 130.966229248047, 132.470166015625, 133.291455078125, 134.123394775391, 135.094036865234, 135.979321289063, 136.629956054688, 137.120587158203, 138.144528198242, 138.773831176758, 140.096417236328, 141.077709960938, 143.200268554688, 144.693508911133, 146.016125488281, 146.890728759766, 147.978680419922, 148.52265625, 150.239880371094, 151.274487304688, 152.44778137207, 153.578366088867, 154.421002197266, 156.842205810547, 157.290188598633, 160.06335144043, 160.404675292969, 160.788662719727, 161.076641845703, 163.305844116211, 163.657849121094, 165.183087158203, 165.7697265625, 166.633679199219, 167.934948730469, 168.830914306641, 169.300198364258, 169.502850341797, 170.484143066406, 170.857464599609, 171.273449707031, 171.95608215332, 173.033337402344, 173.406674194336, 173.80129699707, 174.473263549805, 176.073178100586, 176.78779296875, 177.929089355469, 178.931698608398, 179.486325073242, 180.616940307617, 181.267575073242, 182.280865478516, 183.230130004883, 185.534008789063, 185.821987915039, 186.536618041992, 187.805889892578, 189.20315246582, 189.875119018555, 190.20576171875, 191.869686889648, 192.765621948242, 193.085598754883, 194.056240844727, 195.506832885742, 195.677487182617, 198.578656005859, 200.530545043945, 200.829205322266, 201.501156616211, 202.173123168945, 202.759777832031, 203.357067871094, 206.727551269531, 207.75149230957, 208.999432373047, 212.913906860352, 214.236477661133, 215.484417724609, 218.129620361328, 219.398892211914, 220.711544799805, 222.0333984375, 222.876034545898, 223.558666992188, 224.177304077148, 224.774609375, 227.30244140625, 227.579769897461, 228.571728515625, 229.862316894531, 231.04626159668, 231.632901000977, 231.952877807617, 233.584790039063, 234.576733398438, 236.251309204102, 236.411312866211, 237.349926757813, 238.064556884766, 238.267208862305, 239.365826416016, 239.675122070313, 240.389767456055, 241.339047241211, 241.637692260742, 242.565640258789, 243.461605834961, 244.112225341797, 244.66686706543, 245.413494873047, 246.234783935547, 246.76809387207, 247.258724975586, 247.856030273438, 248.442669677734, 249.434628295898, 250.41589050293, 251.407849121094, 252.058483886719, 252.869091796875, 254.458355712891, 255.514294433594, 256.538220214844, 257.967510986328, 258.884777832031, 259.108776855469, 261.210003662109, 263.140545654297, 264.068493652344, 264.804455566406, 265.337780761719, 265.967083740234, 266.585705566406, 268.644268798828, 269.316235351563, 270.190838623047, 272.910717773438, 274.222637939453, 275.587902832031, 276.217175292969, 277.038494873047, 278.553051757813, 279.438336181641, 280.686291503906, 281.422253417969, 283.406140136719, 284.035443115234, 284.686077880859, 285.656689453125, 286.563305664063, 287.853894042969, 289.187176513672, 289.859143066406, 290.808422851563, 293.549603271484, 294.637554931641, 295.256176757813, 295.853497314453, 296.312145996094, 296.920086669922, 297.389416503906, 297.954693603516, 298.616009521484, 299.511944580078, 300.26923828125, 300.834545898438, 301.421185302734, 302.039807128906, 302.615795898438, 303.202435302734, 303.842388916016, 304.983685302734, 305.612957763672, 306.316906738281, 307.063549804688, 307.863507080078, 308.482159423828, 309.132763671875, 309.815411376953, 310.615368652344, 311.233990478516, 311.884625244141, 312.951245117188, 313.761853027344], [0.96782307624817, 4.15698413848877, 5.22360544204712, 5.82090740203857, 6.41820888519287, 7.27149658203125, 8.13544254302979, 9.10605411529541, 10.524648475647, 11.0899541854858, 11.6872566223145, 12.8711793899536, 13.4898183822632, 14.0764625549316, 14.9190700531006, 15.7723587036133, 16.3376644134521, 16.9989803314209, 18.1722457885742, 18.8228805541992, 19.5055110931396, 20.4867809295654, 21.2547386169434, 21.7773921966553, 22.3000228881836, 23.4199550628662, 24.0492523193359, 24.7212245941162, 25.8838317871094, 26.5237873077393, 27.0997741699219, 27.9957149505615, 28.5930164337158, 29.3716552734375, 32.6461456298828, 34.5233772277832, 35.9739692687988, 36.4219291687012, 36.9979141235352, 38.3524940490723, 38.9178016662598, 40.8163726806641, 41.3816764831543, 41.7229927062988, 44.3041961669922, 45.936100769043, 46.5653961181641, 46.9707038879395, 48.8799331665039, 49.8185470581055, 50.789185333252, 52.1331069946289, 52.7517478942871, 54.0423362731934, 56.6661918640137, 57.7008178710937, 59.3967102050781, 60.2286613464355, 61.4019515991211, 67.172314453125, 69.7001617431641, 70.2868011474609, 72.0787094116211, 73.7212951660156, 74.3185928344727, 75.2678649902344, 75.7691848754883, 76.6331298828125, 76.9317901611328, 78.2223785400391, 79.1716583251953, 79.4809768676758, 80.6222427368164, 82.7448089599609, 83.7474182128906, 85.0273483276367, 87.0432403564453, 87.3632171630859, 88.1205184936523, 88.472492980957, 89.0697982788086, 89.571110534668, 91.6190002441406, 91.9176681518555, 93.2295883178711, 94.4775283813477, 95.3948104858398, 96.397412109375, 98.9252822875977, 100.717190551758, 101.517140197754, 102.44510345459, 104.26900177002, 104.620976257324, 104.951634216309, 106.37022857666, 106.615536499023, 107.223515319824, 108.396778869629, 109.548710632324, 111.564602661133, 112.11925201416, 113.495167541504, 113.761837768555, 114.092472839355, 115.041767883301, 116.86566619873, 118.241589355469, 118.87088470459, 119.894833374023, 121.580067443848, 122.47603302002, 123.243992614746, 123.446644592285, 125.846508789063, 127.798413085938, 128.801022338867, 129.344982910156, 130.720928955078, 132.971478271484, 133.611431884766, 134.475399780273, 135.627331542969, 136.277966308594, 136.928601074219, 137.675213623047, 138.496502685547, 139.061810302734, 140.427075195313, 142.218975830078, 142.677624511719, 142.848278808594, 143.018933105469, 143.498913574219, 143.765560913086, 145.493466186523, 146.378750610352, 147.648022460938, 148.245327758789, 149.663922119141, 149.877239990234, 150.623883056641, 150.815853881836, 151.093167114258, 151.690472412109, 151.914471435547, 153.397045898438, 154.143673706055, 154.847637939453, 155.242291259766, 157.140866088867, 160.06335144043, 160.404675292969, 163.369869995117, 164.233807373047, 165.535076904297, 167.678952026367, 168.254925537109, 171.582745361328, 174.131954956055, 174.771923828125, 176.275830078125, 177.321118164063, 178.249066162109, 180.958248901367, 181.651547241211, 182.003536987305, 182.618099975586, 183.987438964844, 185.534008789063, 185.821987915039, 187.10192565918, 188.424542236328, 191.315029907227, 192.605648803711, 192.968273925781, 196.306774902344, 196.477444458008, 198.866650390625, 201.127850341797, 204.199688720703, 206.919552612305, 210.311367797852, 211.633969116211, 214.236477661133, 222.012066650391, 223.217343139648, 223.867977905273, 224.475933837891, 225.105236816406, 227.30244140625, 227.579769897461, 229.510342407227, 230.427624511719, 231.216915893555, 233.030163574219, 233.200817871094, 234.182080078125, 234.384732055664, 237.061947631836, 238.064556884766, 238.267208862305, 240.635083007813, 241.968350219727, 243.194943237305, 245.210842895508, 246.608090209961, 247.120068359375, 247.717373657227, 250.73586730957, 251.087872314453, 251.887829589844, 252.485119628906, 254.650341796875, 255.684948730469, 257.188854980469, 258.308819580078, 261.540631103516, 263.417858886719, 264.420483398438, 265.007122802734, 267.886975097656, 268.068310546875, 268.249615478516, 269.038922119141, 271.5880859375, 272.910717773438, 274.937268066406, 275.2892578125, 275.854534912109, 277.390454101563, 279.139691162109, 279.865002441406, 280.69697265625, 281.422253417969, 284.035443115234, 284.686077880859, 286.253979492188, 287.213940429688, 289.005841064453, 289.517834472656, 290.168469238281, 294.040234375, 294.936199951172, 295.512188720703, 296.141461181641, 296.760083007813, 297.688061523438, 298.264019775391, 298.957318115234, 299.970593261719, 300.535900878906, 301.111859130859, 301.837170410156, 302.413128662109, 302.935772705078, 303.511730957031, 304.418377685547, 305.303662109375, 305.932934570313, 306.647564697266, 307.554180908203, 308.183483886719, 308.812786865234, 309.655407714844, 310.284710693359, 310.903363037109, 311.5646484375, 312.471264648438, 313.239239501953]]
",
		"music": load("res://music/pretender.wav")
	}
}

func _ready():
	$MusicPlayer.stream = level_info.get(current_level_name).get("music")
	$MusicPlayer.play()
	
	if in_edit_mode:
		Signals.KeyListenerPress.connect(KeyListenerPress)
	else:
		var fk_times = level_info.get(current_level_name).get("fk_times")
		var fk_times_arr = str_to_var(fk_times)
		print(fk_times_arr[0])
		
		var counter: int = 0
		for key in fk_times_arr:
			
			var button_name: String = ""
			match counter:
					0:
						button_name = "button_Z"
					1:
						button_name = "button_X"
					2:
						button_name = "button_N"
					3:
						button_name = "button_M"

			for delay in key:
				SpawnFallingKey(button_name, delay)
				
			counter += 1

func KeyListenerPress(button_name: String, array_num: int):
	#print(str(array_num) + " " + str($MusicPlayer.get_playback_position()))
	fk_output_arr[array_num].append($MusicPlayer.get_playback_position() - fk_fall_time)

func SpawnFallingKey(button_name: String, delay: float):
	await get_tree().create_timer(delay).timeout
	Signals.CreatFallingKey.emit(button_name)

func _on_music_player_finished():
	print(fk_output_arr)
	get_parent().get_node("ScorePoint").clearGame()
